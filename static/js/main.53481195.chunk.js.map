{"version":3,"sources":["utils/index.ts","utils/http.ts","utils/use-async.ts","components/error-boundary.tsx","App.tsx","reportWebVitals.ts","context/index.tsx","index.tsx","auth-provider.ts","components/libs.tsx","context/auth-context.tsx"],"names":["cleanObject","obj","res","Object","keys","forEach","key","val","undefined","isNull","useMount","callBack","useEffect","useMountedRef","mountedRef","useRef","current","useDebounce","value","delay","useState","debouncedVal","setDebouncedVal","timeout","setTimeout","clearTimeout","useDocumentTitle","title","keepOnUnmount","oldTitle","document","resetRoute","window","location","href","origin","apiUrl","process","http","endpoint","a","data","token","headers","customConfig","config","method","Authorization","toUpperCase","qs","stringify","body","JSON","fetch","then","status","auth","reload","Promise","reject","message","json","ok","useHttp","user","useAuth","useCallback","defaultInitialState","stat","error","defaultConfig","throwOnError","useAsync","initialState","initialConfig","useReducer","state","action","safeDispatch","dispatch","useSafeDispatch","retry","setRetry","setData","setError","run","promise","runConfig","Error","catch","isIdle","isLoading","isError","ErrorBoundary","this","props","fallbackRender","children","Component","AuthenticatedApp","React","lazy","UnauthenticatedApp","App","className","FullPageErrorFallback","Suspense","fallback","reportWebVitals","onPerfEntry","Function","getCLS","getFID","getFCP","getLCP","getTTFB","AppProviders","QueryClientProvider","client","QueryClient","loadServer","ReactDOM","render","StrictMode","getElementById","localStorageKey","getToken","localStorage","getItem","handleUserResponse","setItem","login","register","logout","removeItem","Row","styled","div","between","marginBottom","gap","FullPage","FullPageLoading","size","ErrorBox","ButtonNoPad","Button","Text","type","PageContainer","bootstrapUser","AuthContext","createContext","displayName","AuthProvider","setUser","queryClient","useQueryClient","Provider","form","clear","context","useContext"],"mappings":"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","file":"static/js/main.53481195.chunk.js","sourcesContent":["import { useEffect, useRef, useState } from \"react\";\n\nexport const isFalsy = (val: unknown) => (val === 0 ? false : !val);\nexport const isNull = (val: unknown) =>\n  val === undefined || val === null || val === \"\";\n\n// 纯函数，清理\nexport const cleanObject = (obj: Record<string, unknown>) => {\n  const res = { ...obj };\n  Object.keys(res).forEach((key) => {\n    const val = res[key];\n    if (isNull(val)) {\n      delete res[key];\n    }\n  });\n  return res;\n};\n\n// 模拟ComponentDidMount\nexport const useMount = (callBack: (...args: any) => void) => {\n  useEffect(() => {\n    callBack();\n  }, []);\n};\n\nexport const useMountedRef = () => {\n  const mountedRef = useRef(false);\n  useEffect(() => {\n    mountedRef.current = true;\n    return () => {\n      mountedRef.current = false;\n    };\n  });\n  return mountedRef;\n};\n\n/*export function debounce(func, delay) {\n  let timer;\n  return function () {\n    const context = this;\n    const args = Array.prototype.slice.call(arguments);\n    if (timer) {\n      clearTimeout(timer);\n    }\n    timer = setTimeout(() => {\n      func.apply(context, args);\n    }, delay);\n  };\n}*/\n\nexport const useDebounce = <T>(value: T, delay: number) => {\n  const [debouncedVal, setDebouncedVal] = useState(value);\n  useEffect(() => {\n    const timeout = setTimeout(() => {\n      setDebouncedVal(value);\n    }, delay);\n    // value变化会很频繁的情况下，上一次useEffect回调执行后的清理，即相当于清理上一次的timeout, 达到防抖的效果\n    return () => clearTimeout(timeout);\n  }, [value, delay]);\n  return debouncedVal;\n};\n\nexport const useDocumentTitle = (title: string, keepOnUnmount = true) => {\n  // 返回的 ref 对象在组件的整个生命周期内持续存在\n  const oldTitle = useRef(document.title).current;\n  useEffect(() => {\n    document.title = title;\n  }, [title]);\n  useEffect(() => {\n    return () => {\n      if (!keepOnUnmount) {\n        document.title = oldTitle;\n      }\n    };\n  }, [keepOnUnmount]);\n};\n\nexport const resetRoute = () => (window.location.href = window.location.origin);\n","import qs from \"qs\";\nimport * as auth from \"auth-provider\";\nimport { useAuth } from \"../context/auth-context\";\nimport { useCallback } from \"react\";\n\nconst apiUrl = process.env.REACT_APP_API_URL;\n\ninterface Config extends RequestInit {\n  token?: string;\n  data?: object;\n}\n\nexport const http = async (\n  endpoint: string,\n  { data, token, headers, ...customConfig }: Config = {}\n) => {\n  const config = {\n    method: \"GET\",\n    headers: {\n      Authorization: token ? `Bearer ${token}` : \"\",\n      \"Content-Type\": data ? \"application/json\" : \"\",\n    },\n    ...customConfig,\n  };\n  if (config.method.toUpperCase() === \"GET\") {\n    endpoint += `?${qs.stringify(data)}`;\n  } else {\n    config.body = JSON.stringify(data || {});\n  }\n  return window.fetch(`${apiUrl}/${endpoint}`, config).then(async (res) => {\n    if (res.status === 401) {\n      // 登录失效\n      await auth.logout();\n      window.location.reload();\n      return Promise.reject({ message: \"请重新登录\" });\n    }\n    const data = await res.json();\n    if (res.ok) {\n      return data;\n    } else {\n      return Promise.reject(data);\n    }\n  });\n};\n\nexport const useHttp = () => {\n  const { user } = useAuth();\n  return useCallback(\n    (...[endpoint, config]: Parameters<typeof http>) =>\n      http(endpoint, { ...config, token: user?.token }),\n    [user?.token]\n  );\n};\n","import { useCallback, useReducer, useState } from \"react\";\nimport { useMountedRef } from \"./index\";\n\ninterface State<D> {\n  error: Error | null;\n  data: D | null;\n  stat: \"idle\" | \"loading\" | \"error\" | \"success\";\n}\n\nconst defaultInitialState: State<null> = {\n  stat: \"idle\",\n  data: null,\n  error: null,\n};\n\nconst defaultConfig = {\n  throwOnError: false,\n};\n\nconst useSafeDispatch = <T>(dispatch: (...args: T[]) => void) => {\n  const mountedRef = useMountedRef();\n  return useCallback(\n    (...args: T[]) => (mountedRef.current ? dispatch(...args) : void 0),\n    [dispatch, mountedRef]\n  );\n};\n\nexport const useAsync = <D>(\n  initialState?: State<D>,\n  initialConfig?: typeof defaultConfig\n) => {\n  const config = { ...defaultConfig, ...initialConfig };\n  const [state, dispatch] = useReducer(\n    (state: State<D>, action: Partial<State<D>>) => ({ ...state, ...action }),\n    {\n      ...defaultInitialState,\n      ...initialState,\n    }\n  );\n  const safeDispatch = useSafeDispatch(dispatch);\n  // retry是一个函数\n  const [retry, setRetry] = useState(() => () => {});\n  const setData = useCallback(\n    (data: D) =>\n      safeDispatch({\n        data,\n        stat: \"success\",\n        error: null,\n      }),\n    [safeDispatch]\n  );\n  const setError = useCallback(\n    (error: Error) =>\n      safeDispatch({\n        error,\n        stat: \"error\",\n        data: null,\n      }),\n    [safeDispatch]\n  );\n  const run = useCallback(\n    (promise: Promise<D>, runConfig?: { retry: () => Promise<D> }) => {\n      if (!promise || !promise.then) {\n        throw new Error(\"param must be a promise\");\n      }\n      setRetry(() => () => {\n        if (runConfig?.retry()) {\n          run(runConfig?.retry(), runConfig);\n        }\n      });\n      safeDispatch({ stat: \"loading\" });\n      return promise\n        .then((data) => {\n          setData(data);\n          return data;\n        })\n        .catch((error) => {\n          setError(error);\n          if (config.throwOnError) return Promise.reject(error);\n          return error;\n        });\n    },\n    [config.throwOnError, setData, setError, safeDispatch]\n  );\n  return {\n    isIdle: state.stat === \"idle\",\n    isLoading: state.stat === \"loading\",\n    isError: state.stat === \"error\",\n    run,\n    setData,\n    setError,\n    retry,\n    ...state,\n  };\n};\n","import { Component, PropsWithChildren, ReactElement } from \"react\";\n\ntype FallbackRender = (props: { error: Error | null }) => ReactElement;\n\n/*type Props = {\n  children: ReactNode; // children如果是常用的属性，那么类型可以用React定义的泛型PropsWithChildren<T>\n  fallbackRender: FallbackRender;\n};*/\nexport class ErrorBoundary extends Component<\n  PropsWithChildren<{ fallbackRender: FallbackRender }>,\n  { error: Error | null }\n> {\n  state = {\n    error: null,\n  };\n  static getDerivedStateFromError(error: Error) {\n    return { error };\n  }\n  render() {\n    const { error } = this.state;\n    const { fallbackRender, children } = this.props;\n    if (error) {\n      return fallbackRender({ error });\n    }\n    return children;\n  }\n}\n","import React from \"react\";\nimport \"./App.css\";\nimport { useAuth } from \"./context/auth-context\";\n/*import { AuthenticatedApp } from \"./authenticated-app\";\nimport { UnauthenticatedApp } from \"./unauthenticated-app\";*/\nimport { ErrorBoundary } from \"components/error-boundary\";\nimport { FullPageErrorFallback, FullPageLoading } from \"./components/libs\";\n\n/* React懒加载*/\nconst AuthenticatedApp = React.lazy(() => import(\"./authenticated-app\"));\nconst UnauthenticatedApp = React.lazy(() => import(\"./unauthenticated-app\"));\n\nfunction App() {\n  const { user } = useAuth();\n  return (\n    <div className=\"App\">\n      <ErrorBoundary fallbackRender={FullPageErrorFallback}>\n        <React.Suspense fallback={<FullPageLoading />}>\n          {user ? <AuthenticatedApp /> : <UnauthenticatedApp />}\n        </React.Suspense>\n      </ErrorBoundary>\n    </div>\n  );\n}\n\nexport default App;\n","import { ReportHandler } from 'web-vitals';\r\n\r\nconst reportWebVitals = (onPerfEntry?: ReportHandler) => {\r\n  if (onPerfEntry && onPerfEntry instanceof Function) {\r\n    import('web-vitals').then(({ getCLS, getFID, getFCP, getLCP, getTTFB }) => {\r\n      getCLS(onPerfEntry);\r\n      getFID(onPerfEntry);\r\n      getFCP(onPerfEntry);\r\n      getLCP(onPerfEntry);\r\n      getTTFB(onPerfEntry);\r\n    });\r\n  }\r\n};\r\n\r\nexport default reportWebVitals;\r\n","import { ReactNode } from \"react\";\nimport { AuthProvider } from \"./auth-context\";\nimport { QueryClient, QueryClientProvider } from \"react-query\";\nimport React from \"react\";\n\nexport const AppProviders = ({ children }: { children: ReactNode }) => {\n  return (\n    <QueryClientProvider client={new QueryClient()}>\n      <AuthProvider>{children}</AuthProvider>\n    </QueryClientProvider>\n  );\n};\n","// import \"./wdyr\";\nimport React from \"react\";\nimport ReactDOM from \"react-dom\";\nimport App from \"./App\";\nimport reportWebVitals from \"./reportWebVitals\";\nimport { loadServer, DevTools } from \"jira-dev-tool\";\n// 在Jira DevTools后面引入，用于覆盖默认样式\nimport \"antd/dist/antd.less\";\nimport { AppProviders } from \"context\";\nloadServer(() => {\n  ReactDOM.render(\n    <React.StrictMode>\n      <AppProviders>\n        <DevTools />\n        <App />\n      </AppProviders>\n    </React.StrictMode>,\n    document.getElementById(\"root\")\n  );\n});\n\n// If you want to start measuring performance in your app, pass a function\n// to log results (for example: reportWebVitals(console.log))\n// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals\nreportWebVitals();\n","import { User } from \"./types/user\";\n\nconst localStorageKey = \"__auth_provider_token__\";\nconst apiUrl = process.env.REACT_APP_API_URL;\nexport const getToken = () => window.localStorage.getItem(localStorageKey);\nexport const handleUserResponse = ({ user }: { user: User }) => {\n  window.localStorage.setItem(localStorageKey, user.token || \"\");\n  return user;\n};\n\nexport const login = (data: { username: string; password: string }) => {\n  return fetch(`${apiUrl}/login`, {\n    method: \"POST\",\n    headers: {\n      \"Content-Type\": \"application/json\",\n    },\n    body: JSON.stringify(data),\n  }).then(async (res) => {\n    if (res.ok) {\n      return handleUserResponse(await res.json());\n    }\n    return Promise.reject(await res.json());\n  });\n};\n\nexport const register = (data: { username: string; password: string }) => {\n  return fetch(`${apiUrl}/register`, {\n    method: \"POST\",\n    headers: {\n      \"Content-Type\": \"application/json\",\n    },\n    body: JSON.stringify(data),\n  }).then(async (res) => {\n    if (res.ok) {\n      return handleUserResponse(await res.json());\n    }\n    return Promise.reject(await res.json());\n  });\n};\n\nexport const logout = async () =>\n  window.localStorage.removeItem(localStorageKey);\n","import styled from \"@emotion/styled\";\nimport { Button, Spin, Typography } from \"antd\";\nimport { DevTools } from \"jira-dev-tool\";\nimport React from \"react\";\n\ntype RowProps = {\n  gap?: number | boolean | undefined;\n  between?: boolean;\n  marginBottom?: number;\n};\n\nexport const Row = styled.div<RowProps>`\n  display: flex;\n  align-items: center;\n  justify-content: ${(props) => (props.between ? \"space-between\" : undefined)};\n  margin-bottom: ${(props) => props.marginBottom || 0 + \"rem\"};\n  > * {\n    margin-top: 0 !important;\n    margin-bottom: 0 !important;\n    margin-right: ${(props) =>\n      typeof props.gap === \"number\"\n        ? props.gap + \"rem\"\n        : props.gap\n        ? \"2rem\"\n        : undefined};\n  }\n`;\n\nconst FullPage = styled.div`\n  width: 100vw;\n  height: 100vh;\n  display: flex;\n  justify-content: center;\n  align-items: center;\n`;\n\nexport const FullPageLoading = () => (\n  <FullPage>\n    <Spin size={\"large\"} />\n  </FullPage>\n);\n\nexport const FullPageErrorFallback = ({ error }: { error: Error | null }) => (\n  <FullPage>\n    <ErrorBox error={error} />\n    <DevTools />\n  </FullPage>\n);\n\nexport const ButtonNoPad = styled(Button)`\n  padding: 0;\n`;\n\n// 类型守卫\nconst isError = (val: any): val is Error => !!val?.message;\n\nexport const ErrorBox = ({ error }: { error: unknown }) => {\n  if (isError(error)) {\n    return <Typography.Text type={\"danger\"}>{error?.message}</Typography.Text>;\n  }\n  return null;\n};\n\nexport const PageContainer = styled.div`\n  padding: 3.2rem;\n  width: 100%;\n  display: flex;\n  flex-direction: column;\n`;\n","import React, { ReactNode } from \"react\";\nimport * as auth from \"auth-provider\";\nimport { http } from \"../utils/http\";\nimport { useMount } from \"../utils\";\nimport { useAsync } from \"../utils/use-async\";\nimport { FullPageErrorFallback, FullPageLoading } from \"components/libs\";\nimport { useQueryClient } from \"react-query\";\nimport { User } from \"../types/user\";\n\ninterface AuthForm {\n  username: string;\n  password: string;\n}\n\nconst bootstrapUser = async () => {\n  let user = null;\n  const token = auth.getToken();\n  if (token) {\n    const data = await http(\"me\", { token });\n    user = data.user;\n  }\n  return user;\n};\n\n// AuthContext声明\nconst AuthContext = React.createContext<\n  | {\n      user: User | null;\n      register: (form: AuthForm) => Promise<void>;\n      login: (form: AuthForm) => Promise<void>;\n      logout: () => Promise<void>;\n    }\n  | undefined\n>(undefined);\nAuthContext.displayName = \"AuthContext\";\n\n// AuthContext的Provider\nexport const AuthProvider = ({ children }: { children: ReactNode }) => {\n  const {\n    data: user,\n    error,\n    isLoading,\n    isIdle,\n    isError,\n    setData: setUser,\n    run,\n  } = useAsync<User | null>();\n  const queryClient = useQueryClient();\n  const login = (form: AuthForm) => auth.login(form).then(setUser);\n  const register = (form: AuthForm) => auth.register(form).then(setUser);\n  const logout = () =>\n    auth.logout().then(() => {\n      setUser(null);\n      queryClient.clear();\n    });\n\n  useMount(() => {\n    run(bootstrapUser());\n  });\n  if (isIdle || isLoading) {\n    return <FullPageLoading />;\n  }\n  if (isError) {\n    return <FullPageErrorFallback error={error} />;\n  }\n  return (\n    <AuthContext.Provider value={{ user, login, register, logout }}>\n      {children}\n    </AuthContext.Provider>\n  );\n};\n\nexport const useAuth = () => {\n  const context = React.useContext(AuthContext);\n  if (!context) {\n    throw new Error(\"userAuth 必须在AuthProvider中是使用\");\n  }\n  return context;\n};\n"],"sourceRoot":""}